<!DOCTYPE html>
<html>
<head>
  <title>ASX ETF Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .ticker-form { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .last-updated { color: #6c757d; font-size: 0.9rem; margin-bottom: 1rem; }
  </style>
</head>
<body class="container mt-4">
  <h1>ASX ETF Tracker</h1>
  <div id="last-updated" class="last-updated"></div>
  
  <!-- Add/Remove Ticker Form -->
  <div class="ticker-form mb-4">
    <div class="row">
      <div class="col-md-6">
        <input type="text" id="new-ticker" class="form-control" placeholder="e.g., VAS.AX" aria-label="Ticker">
      </div>
      <div class="col-md-3">
        <button id="add-ticker" class="btn btn-primary w-100">Add Ticker</button>
      </div>
      <div class="col-md-3">
        <button id="remove-ticker" class="btn btn-danger w-100">Remove Selected</button>
      </div>
    </div>
  </div>

  <!-- ETF Table -->
  <table class="table table-striped" id="etf-table">
    <thead>
      <tr>
        <th><input type="checkbox" id="select-all"></th>
        <th>Ticker</th>
        <th>Name</th>
        <th>Price (AUD)</th>
        <th>Avg 10D Vol</th>
        <th>YTD Return (%)</th>
        <th>3Y Return (%)</th>
        <th>5Y Return (%)</th>
        <th>P/E</th>
        <th>Div Yield (%)</th>
        <th>52W High</th>
        <th>52W Low</th>
        <th>Inception</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Load data and render table
    let etfData = [];
    let lastUpdated = '';
    
    async function loadData() {
      const response = await fetch('data.json');
      const data = await response.json();
      if (data.length > 0) {
        etfData = data;
        lastUpdated = data[0].Updated; // Get update time from first entry
        document.getElementById('last-updated').textContent = `Last updated: ${lastUpdated}`;
        renderTable();
      }
    }

    // Render table with checkboxes
    function renderTable() {
      const tbody = document.querySelector("#etf-table tbody");
      tbody.innerHTML = etfData.map(etf => `
        <tr>
          <td><input type="checkbox" class="ticker-checkbox" data-ticker="${etf.Ticker}"></td>
          <td>${etf.Ticker}</td>
          <td>${etf.Name}</td>
          <td>${etf['Price (AUD)']?.toFixed(2) || 'N/A'}</td>
          <td>${etf['Average 10-day Volume']?.toLocaleString() || 'N/A'}</td>
          <td>${etf['YTD Return (%)'] !== null ? etf['YTD Return (%)'].toFixed(2) : 'N/A'}</td>
          <td>${etf['3Y Return (%)'] !== null ? etf['3Y Return (%)'].toFixed(2) : 'N/A'}</td>
          <td>${etf['5Y Return (%)'] !== null ? etf['5Y Return (%)'].toFixed(2) : 'N/A'}</td>
          <td>${etf['P/E Ratio'] || 'N/A'}</td>
          <td>${etf['Dividend Yield'] !== null ? etf['Dividend Yield'].toFixed(2) : 'N/A'}</td>
          <td>${etf['52 Week High']?.toFixed(2) || 'N/A'}</td>
          <td>${etf['52 Week Low']?.toFixed(2) || 'N/A'}</td>
          <td>${etf['Inception Date'] || 'N/A'}</td>
        </tr>
      `).join("");
    }

    // Add/remove tickers logic (same as before)
    document.getElementById("add-ticker").addEventListener("click", async () => {
      const ticker = document.getElementById("new-ticker").value.trim().toUpperCase();
      if (!ticker) return;
      
      await fetch(`https://api.github.com/repos/your-username/asx-tracker/dispatches`, {
        method: "POST",
        headers: {
          "Authorization": "token YOUR_PAT",
          "Accept": "application/vnd.github.everest-preview+json"
        },
        body: JSON.stringify({
          event_type: "add_ticker",
          client_payload: { ticker }
        })
      });
      
      alert("Ticker added! Page will refresh after next update.");
    });

    document.getElementById("remove-ticker").addEventListener("click", async () => {
      const selected = Array.from(document.querySelectorAll(".ticker-checkbox:checked"))
        .map(el => el.dataset.ticker);
      
      if (selected.length === 0) return;
      
      await fetch(`https://api.github.com/repos/your-username/asx-tracker/dispatches`, {
        method: "POST",
        headers: {
          "Authorization": "token YOUR_PAT",
          "Accept": "application/vnd.github.everest-preview+json"
        },
        body: JSON.stringify({
          event_type: "remove_ticker",
          client_payload: { tickers: selected }
        })
      });
      
      alert("Tickers removed! Page will refresh after next update.");
    });

    // Initialize
    loadData();
  </script>
</body>
</html>